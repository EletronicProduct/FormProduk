<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Admin Produk</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="style.css"/>

</head>
<body class="bg-gray-100 font-sans p-4 min-h-screen flex items-start justify-center">
    <div id="app" class="container mx-auto max-w-7xl">
        <div v-if="appLoading" class="text-center text-gray-500 text-lg py-10">
            <svg class="animate-spin h-10 w-10 text-teal-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4">Memuat aplikasi...</p>
        </div>

        <div v-else>
            <div v-if="currentView === 'table'" class="w-full">
                <div class="flex flex-col sm:flex-row items-center justify-between mb-8">
                    <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-4 sm:mb-0">Daftar Produk</h1>
                    <button @click="showAddForm" class="inline-block bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300">
                        + Tambah Produk Baru
                    </button>
                </div>

                <div v-if="products.length === 0" class="text-center text-gray-500 text-lg py-10">
                    Tidak ada produk ditemukan.
                </div>

                <div v-else class="bg-white rounded-lg shadow-lg overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Gambar
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Nama Produk
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Harga Dasar
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    DP
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Kategori
                                </th>
                                <th scope="col" class="relative px-6 py-3">
                                    <span class="sr-only">Aksi</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr v-for="product in products" :key="product.id">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <img :src="product.imageUrls && product.imageUrls.length > 0 ? product.imageUrls[0] : 'https://placehold.co/50x50/E5E7EB/4B5563?text=N/A'"
                                         alt="Gambar Produk"
                                         class="w-12 h-12 rounded-md object-cover" />
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">{{ product.name }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-500">{{ formatCurrency(product.basePrice) }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-500">{{ formatCurrency(product.downPayment) }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                        :class="{'bg-blue-100 text-blue-800': product.category === 'electronics', 'bg-green-100 text-green-800': product.category === 'furniture'}">
                                        {{ product.category }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                    <button @click="showEditForm(product.id)" class="text-indigo-600 hover:text-indigo-900 mr-4">Edit</button>
                                    <button @click="showDeleteModal(product.id, product.name)" class="text-red-600 hover:text-red-900">Hapus</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div v-else-if="currentView === 'form'" class="w-full">
                <button @click="showTableView" class="mb-6 flex items-center text-gray-600 hover:text-gray-800 transition-colors duration-200">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    Kembali ke Daftar
                </button>
                <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">{{ formTitle }}</h1>

                <form @submit.prevent="saveProduct" class="bg-white p-6 md:p-10 rounded-xl shadow-lg max-w-2xl mx-auto">
                    <div class="space-y-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Nama Produk</label>
                            <input v-model="product.name" type="text" id="name" required
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" />
                        </div>

                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700">Deskripsi</label>
                            <textarea v-model="product.description" id="description" rows="3" required
                                      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500"></textarea>
                        </div>
                        
                        <div>
                            <label for="imageUpload" class="block text-sm font-medium text-gray-700">Upload Gambar</label>
                            <input @change="handleFileChange" type="file" id="imageUpload" accept="image/*"
                                   class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-teal-50 file:text-teal-700 hover:file:bg-teal-100" />
                            <p v-if="isUploading" class="text-xs text-gray-500 mt-1">Mengunggah gambar... Jangan tutup halaman ini.</p>
                            <div v-if="imagePreviewUrl" class="mt-4 w-32 h-32 relative">
                                <img :src="imagePreviewUrl" alt="Pratinjau Gambar" class="w-full h-full object-cover rounded-md shadow" />
                                <button @click="removeImage" type="button" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 leading-none text-xs w-6 h-6 flex items-center justify-center">
                                    &times;
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="basePrice" class="block text-sm font-medium text-gray-700">Harga Dasar (IDR)</label>
                                <input v-model.number="product.basePrice" type="number" id="basePrice" required
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" />
                            </div>
                            <div>
                                <label for="downPayment" class="block text-sm font-medium text-gray-700">Uang Muka (DP) (IDR)</label>
                                <input v-model.number="product.downPayment" type="number" id="downPayment" required
                                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" />
                            </div>
                        </div>

                        <div>
                            <label for="whatsappNumber" class="block text-sm font-medium text-gray-700">Nomor WhatsApp</label>
                            <input v-model="product.whatsappNumber" type="tel" id="whatsappNumber" placeholder="Contoh: 6281234567890"
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" />
                        </div>

                        <div>
                            <label for="category" class="block text-sm font-medium text-gray-700">Kategori</label>
                            <select v-model="product.category" id="category" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500">
                                <option value="">Pilih Kategori</option>
                                <option value="electronics">Elektronik</option>
                                <option value="furniture">Furniture</option>
                            </select>
                        </div>

                        <div>
                            <h3 class="text-sm font-medium text-gray-700 mb-2">Opsi Tenor (Hari)</h3>
                            <div class="flex items-center space-x-4 mb-2">
                                <div v-for="tenor in [60, 90, 120, 150, 180]" :key="tenor" class="flex items-center">
                                    <input type="checkbox" :id="'tenor-' + tenor" :value="tenor" v-model="product.tenorOptions"
                                           class="h-4 w-4 text-teal-600 rounded border-gray-300 focus:ring-teal-500" />
                                    <label :for="'tenor-' + tenor" class="ml-2 text-sm text-gray-600">{{ tenor }} Hari</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-6">
                            <h3 class="text-sm font-bold text-gray-800 mb-4">Multiplier Elektronik</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                <div v-for="(value, tenor) in multipliers.electronics" :key="tenor">
                                    <label :for="'electronics-' + tenor" class="block text-xs font-medium text-gray-700">{{ tenor }} Hari</label>
                                    <input v-model.number="multipliers.electronics[tenor]" type="number" :id="'electronics-' + tenor" step="0.01" required
                                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" />
                                </div>
                            </div>
                        </div>

                        <div class="border-t border-gray-200 pt-6">
                            <h3 class="text-sm font-bold text-gray-800 mb-4">Multiplier Furniture</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                <div v-for="(value, tenor) in multipliers.furniture" :key="tenor">
                                    <label :for="'furniture-' + tenor" class="block text-xs font-medium text-gray-700">{{ tenor }} Hari</label>
                                    <input v-model.number="multipliers.furniture[tenor]" type="number" :id="'furniture-' + tenor" step="0.01" required
                                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500" />
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center mt-8">
                            <button type="submit"
                                    :class="{'opacity-50 cursor-not-allowed': isSaving || isUploading}"
                                    :disabled="isSaving || isUploading"
                                    class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300">
                                {{ saveButtonText }}
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <transition name="modal">
            <div v-if="showDeleteModalState" @click.self="hideDeleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full mx-auto modal-content">
                    <h3 class="text-lg font-bold mb-4">Konfirmasi Hapus</h3>
                    <p class="text-gray-600 mb-6">Anda yakin ingin menghapus produk "{{ productToDelete.name }}"?</p>
                    <div class="flex justify-end space-x-4">
                        <button @click="hideDeleteModal" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Batal</button>
                        <button @click="confirmDelete" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Hapus</button>
                    </div>
                </div>
            </div>
        </transition>

        <div v-if="snackbar.show" :class="`fixed bottom-4 right-4 p-4 rounded-lg shadow-lg text-white ${snackbar.color} snackbar`">
            {{ snackbar.text }}
        </div>

    </div>

    <script type="module" src="main.js">
        
    </script>
</body>
</html>
